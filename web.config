<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    <handlers>
      <add name="PythonHandler" path="*" verb="*" modules="FastCgiModule" 
           scriptProcessor="C:\Python310\python.exe|C:\Python310\Lib\site-packages\wfastcgi.py" 
           resourceType="Unspecified" requireAccess="Script" />
    </handlers>
    <rewrite>
      <rules>
        <!-- Se a requisição for para um arquivo estático, redirecione para a pasta "dist" -->
        <rule name="StaticFiles" stopProcessing="true">
          <match url="^(assets|js|css|fonts|img|static)(.*)$" />
          <action type="Rewrite" url="dist/{R:1}{R:2}" />
        </rule>
        <!-- Para todos os arquivos estáticos, verificar se existem em dist -->
        <rule name="Static Files" stopProcessing="true">
          <match url=".*\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$" />
          <action type="Rewrite" url="dist/{R:0}" appendQueryString="true" />
          <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
          </conditions>
        </rule>
        <!-- Se a requisição for para /api, dirija para o Flask -->
        <rule name="Flask API" stopProcessing="true">
          <match url="^api(.*)$" />
          <action type="Rewrite" url="wsgi.py/{R:0}" />
        </rule>
        <!-- Caso contrário, redirecione para o front-end em dist -->
        <rule name="Vue Routes" stopProcessing="true">
          <match url=".*" />
          <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
          </conditions>
          <action type="Rewrite" url="dist/index.html" />
        </rule>
      </rules>
    </rewrite>
    <httpErrors errorMode="Detailed" />
    <httpProtocol>
      <customHeaders>
        <add name="X-Powered-By" value="Flask" />
      </customHeaders>
    </httpProtocol>
    <fastCgi>
      <application fullPath="C:\Python310\python.exe" arguments="C:\Python310\Lib\site-packages\wfastcgi.py">
        <environmentVariables>
          <environmentVariable name="PYTHONPATH" value="C:\inetpub\wwwroot\agenda-mercocamp" />
          <environmentVariable name="FLASK_APP" value="wsgi.py" />
          <environmentVariable name="DB_HOST" value="mercocamp.ip.odhserver.com" />
          <environmentVariable name="DB_PORT" value="33101" />
          <environmentVariable name="DB_USER" value="projetos" />
          <environmentVariable name="DB_PASSWORD" value="masterkey" />
          <environmentVariable name="DB_USERS" value="dbusers" />
          <environmentVariable name="DB_CHECKIN" value="dbcheckin" />
          <environmentVariable name="DB_MERCOCAMP" value="dbmercocamp" />
          <environmentVariable name="JWT_SECRET" value="SeuSegredoJWT" />
          <environmentVariable name="JWT_EXPIRE" value="7d" />
          <!-- WSGI Handler - Não altere esta variável -->
          <environmentVariable name="WSGI_HANDLER" value="wsgi.application" />
        </environmentVariables>
      </application>
    </fastCgi>
  </system.webServer>
</configuration>